sudo: required

dist: xenial

services:
  - docker

env:
  global:
    - DOCKER_USER=jsloan117
    - DOCKER_PASS=
    - DOCKER_REPO=test-ci
    - IMAGE_NAME=$DOCKER_USER/$DOCKER_REPO
#    - DOCKERFILE=Dockerfile

#install: skip

jobs:
  include:
 #   - stage: Set image tag
 #     script: |
 #       echo -e '\n<<< Setting docker image tag format >>>\n'
 #       if [ "$TRAVIS_BRANCH" == "master" ]; then IMAGE_TAG=latest; else IMAGE_TAG=$TRAVIS_BRANCH; fi
 #       echo $IMAGE_TAG; export IMAGE_TAG

    - stage: build docker images
      env:
        - CI_PLATFORM=travisci
      script: |
        if [ "$TRAVIS_BRANCH" == "master" ]; then IMAGE_TAG=latest; else IMAGE_TAG=$TRAVIS_BRANCH; fi
        export IMAGE_TAG
        echo -e '\n<<< Building default docker images >>>\n'
        docker build -f Dockerfile -t $IMAGE_NAME:$CI_PLATFORM-$IMAGE_TAG .

    - stage: build ubuntu docker images
      env:
        - DOCKERFILE=Dockerfile.ubuntu
        - DIST=ubuntu
        - CI_PLATFORM=travisci
      script: |
        if [ "$TRAVIS_BRANCH" == "master" ]; then IMAGE_TAG=latest; else IMAGE_TAG=$TRAVIS_BRANCH; fi
        export IMAGE_TAG
        echo -e '\n<<< Building alternative docker images >>>\n'
        docker build -f Dockerfile.ubuntu -t $IMAGE_NAME:$DIST-$CI_PLATFORM-$IMAGE_TAG .

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $TOKEN
  keep_history: true
  #local_dir: site
  committer_from_gh: true
  on:
    branch: master
