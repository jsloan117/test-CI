language: minimal
services: docker
dist: bionic

env:
  global:
    - IMAGE_NAME=jsloan117/test-ci
    - CI_PLATFORM=travisci

jobs:
  include:
    - stage: build docker images
      script: |
        if [ $TRAVIS_BRANCH = master ]; then IMAGE_TAG=latest; else IMAGE_TAG=$TRAVIS_BRANCH; export IMAGE_TAG; fi
        docker build -f Dockerfile -t $IMAGE_NAME:$CI_PLATFORM-$IMAGE_TAG .
        if [ $TRAVIS_PULL_REQUEST = false ] && [ $TRAVIS_BRANCH = dev -o $TRAVIS_BRANCH = master ]; then
          printf "\nI would be logging in and pushing stuff................\n\n"
        fi

    - stage: build ubuntu docker images
      script: |
        if [ $TRAVIS_BRANCH = master ]; then IMAGE_TAG=latest; else IMAGE_TAG=$TRAVIS_BRANCH; export IMAGE_TAG; fi
        docker build -f Dockerfile.ubuntu -t $IMAGE_NAME:ubuntu-$CI_PLATFORM-$IMAGE_TAG .
        if [ $TRAVIS_PULL_REQUEST = false ] && [ $TRAVIS_BRANCH = dev -o $TRAVIS_BRANCH = master ]; then
          printf "\nI would be logging in and pushing stuff................\n\n"
        fi

    - stage: build documentation
      if: branch = dev
      language: python
      python: 3.7.5
      script: |
        pip3 install mkdocs mkdocs-material
        #mkdocs gh-deploy --message "Deployed {sha} with MkDocs version {version}. [skip ci]"
        mkdocs build -cs
